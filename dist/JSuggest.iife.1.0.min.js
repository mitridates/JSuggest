var JSuggest=function(){"use strict";let e=function(e){let t=/Android|webOS|iPhone|iPad|BlackBerry|Windows Phone|Opera Mini|IEMobile|Mobile/i.test(e),n=t&&e.indexOf("Firefox");return{ua:e,isMobileDevice:t,isMobileFirefox:n,keyUpEventName:n?"input":"keyup"}}(navigator.userAgent),t={req:null,isOpen:null,selected:null,keypressCounter:0,debounceTimer:void 0,items:[]};const n={width:null,fetch:null,path:null,method:"POST",debounceWaitMs:300,minLen:3,noResults:"No result found...",placeholder:"",searchPlaceholder:"minLength caracteres para buscar ...",showOnFocus:!1,disabled:!1};function s(e,t){let n,i;if("string"==typeof e)return s(document.createElement(e),t);if(t&&"[object Object]"===Object.prototype.toString.call(t))for(n in t)if(n in e)if("style"===n)for(i in t[n])e.style[i]=t[n][i];else e[n]=t[n];else"html"===n?e.innerHTML=t[n]:"textcontent"===n?e.textContent=t[n]:e.setAttribute(n,t[n]);return e}function i(e,t){let n,i=t.nodeName.toLowerCase();if("select"===i){if(!t.options.length)return;n=t.options.selectedIndex,s(e,{value:t.options[n].text,title:t.options[n].value+" "+t.options[n].text}),e.value=t.options[n].text}else"input"===i&&(s(e,{value:t.value,title:t.title+" "+t.value}),e.value=t.value)}function l(){for(this.vars.items.length=0,this.vars.keypressCounter++,this.vars.selected=void 0;this.elms.container.firstChild;)this.elms.container.removeChild(this.elms.container.lastChild);this.elms.falseInput.tabIndex=0,this.elms.realInput.tabIndex=-1,this.elms.container.style.display="none",this.vars.isOpen=!1}function r(){let e=this.elms.src;s(this.elms.falseInput,{value:"",title:"",idx:""}),"select"===e.nodeName.toLowerCase()?e.options.length=0:(e.value="",e.title=""),l.call(this)}var a=function(){let e=this,t={},n={};return{addInstance:function(e,n){t[e]=n},getInstance:function e(n){let s;return n?"string"==typeof n?t.hasOwnProperty(n)?t[n]:null:n.nodeType&&(n.classList.contains("jsuggest-false-input")?s=n.parentNode.parentNode.querySelector("[data-jsuggest]"):n.dataset.jsuggest&&(s=n),s)?e(s.dataset.randid):null:null},addTemplate:function(t,s){return n[t]=s,e},getTemplate:function(e){return n.hasOwnProperty(e.type)?new n[e.type](e):null}}}();function o(){let e,t=this.vars,n=this.elms,s=v.realInputBlurListener.bind(this);n.container.childNodes.forEach((function(n){n.classList.remove("selected"),n.getAttribute("idx")===t.selected.get("id")&&(n.classList.add("selected"),e=n)})),n.realInput.removeEventListener("blur",s),e&&e.focus(),n.realInput.addEventListener("blur",s),n.realInput.focus()}function c(){let e,t=this.elms.container,n=this.vars,i=this.config,r=document.createDocumentFragment();for(t.style.display="block";t.firstChild;)t.removeChild(t.firstChild);if(n.items.forEach((function(t,n){e=function(e,t){let n,i=e.toString(),l=a.getTemplate(e);return n=s("div",{style:{"font-size":".7em"},idx:e.get("id"),"data-index":t,tabIndex:-1}),l?l.getItem(n,t):(n.appendChild(document.createTextNode(i)),n)}(t,n),e&&(e.addEventListener("click",v.itemClickListener),r.appendChild(e))})),t.appendChild(r),n.items.length<1){if(!i.noResults)return void l.call(this);{let e=document.createElement("div");e.className="empty",e.textContent=i.noResults,t.appendChild(e)}}else o.call(this);this.vars.isOpen=!0}function u(){this.vars.debounceTimer&&window.clearTimeout(this.vars.debounceTimer)}function d(e){let t=this.elms.realInput.value,n=this,s=++this.vars.keypressCounter;t.length>=n.config.minLen||1===e?(u.call(n),n.vars.debounceTimer=window.setTimeout((function(){let e=function(e){n.vars.keypressCounter===s&&e&&(n.vars.items=e,n.vars.selected=e.length?e[0]:void 0,c.call(n))};n.config.path?p.call(n,t,e,0):n.config.fetch?(n.vars.items=function(e,t){let n,s;var i,l;for(i=e.fetch,l={filterCb:(e,t)=>-1!==e.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").indexOf(t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")),sortCb:function(e,t){return e.toString().localeCompare(t.toString())}},n={parsed:Array.isArray(i)?[...i]:[...i.data],filterCb:i.hasOwnProperty("filterCb")?i.filterCb:l.filterCb,sortCb:i.hasOwnProperty("sortCb")?i.sortCb:l.sortCb},s=n.parsed.length;s--;)n.parsed[s],n.filterCb(n.parsed[s],t)||n.parsed.splice(s,1);return n.parsed.sort(fetch.sortCb),n.parsed}(n.config,t),n.vars.selected=n.vars.items.length?n.vars.items[0]:void 0,c.call(n)):console.log("Nada que buscar")}),0===e?n.config.debounceWaitMs:300)):l.call(n)}function p(e,t,n){let s,i,l,r=this.config.path;try{this.vars.req.abort()}catch(e){}this.vars.req=l=new XMLHttpRequest,l.responseType="json",l.onload=()=>{l.status>=200&&l.status<300?(s=l.response,i=new JsonApiManager(s.data,s.included),t(i.getParsed())):alert(`Error ${l.status} : ${l.statusText}`)},"GET"===this.config.method?(l.open("GET",r+`?term=${e.toLowerCase()}`),l.send()):(l.open("POST",r),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.send(`term=${e.toLowerCase()}`))}function h(e){let t,n,i,l=this.elms,r=l.src,o=this.vars,c=r.nodeName.toLowerCase();if(!(e instanceof JsonApiSpec))throw new Error("Invalid argument. expected instance of JsonApiSpec, got "+typeof e);i=e.toString(),o.selected!==e&&(o.selected=e),t=a.getTemplate(e),n=s(l.falseInput,{value:i,title:i+". "+e.id,idx:e.id}),t&&t.setInput(n),"select"===c?(r.length=0,r.appendChild(s("option",{value:e.id,text:i,selected:"selected"}))):"input"===c&&s(r,{value:e.id,title:i+". "+e.id})}function f(){let e,t=this.vars;if(t.items.length<1)t.selected=void 0;else if(t.selected===t.items[0])t.selected=t.items[t.items.length-1];else for(e=t.items.length-1;e>0;e--)if(t.selected===t.items[e]||1===e){t.selected=t.items[e-1];break}}function m(){let e=this.vars;if(e.items.length<1&&(e.selected=void 0),e.selected&&e.selected!==e.items[e.items.length-1]){for(let t=0;t<e.items.length-1;t++)if(e.selected===e.items[t]){e.selected=e.items[t+1];break}}else e.selected=e.items[0]}var v={realInputKeydownListener:function(e){let t=!!this.elms.container.firstChild,n=document.activeElement,s=e.which||e.keyCode||0;if(38===s||40===s||27===s){if(27===s)l.call(this),n.blur();else{if(!t||this.vars.items.length<1)return;38===s?f.call(this):m.call(this),o.call(this)}return e.preventDefault(),void(t&&e.stopPropagation())}13===s&&(this.vars.selected&&(h.call(this,this.vars.selected,this.elms.container.querySelector(".selected")),l.call(this),n.blur()),e.preventDefault(),e.stopPropagation())},realInputKeyupListener:function(e){let t=e.which||e.keyCode||0;-1===[38,13,27,39,37,16,17,18,20,91,9].indexOf(t)&&(t>=112&&t<=123||40===t&&this.elms.container.firstChild||d.call(this,0))},itemClickListener:function(e){this.vars.selected=this.vars.items[e.currentTarget.getAttribute("data-index")],h(this.vars.selected,e.currentTarget),l.call(this),e.preventDefault(),e.stopPropagation()},containerMousedownListener:function(e){e.stopPropagation(),e.preventDefault()},realInputBlurListener:function(){let e=this;setTimeout((function(){document.activeElement!==e.elms.realInput&&(l.call(e),e.elms.dropdowncontent.style.display="none")}),200)},realInputFocusListener:function(e){this.config.showOnFocus&&d.call(this,1)},falseClearClickListener:function(e){r.call(this),s(this.elms.falseInput,{value:"",title:"",idx:""}),l.call(this)},falseInputFocusListener:function(e){s(this.elms.dropdowncontent,{style:{display:"block"},tabIndex:-1}),s(this.elms.realInput,{value:""}).focus(),this.elms.falseInput.tabIndex=-1},falseInputChangeListener:function(e){let t=e.currentTarget;""===t.value&&(t.setAttribute("title",""),t.setAttribute("idx",""),this.elms.src.length=0)},formResetListener:function(e){let t=this.elms.src,n=this.elms.copy;"select"===t.nodeName.toLowerCase()?t.innerHTML=n:(t.value=n,t.title=""),i(this.elms.falseInput,t)},containerFocusListener:function(e){this.elms.realInput.focus()}};function g(){this.elms.falseInput.disabled=!0,this.elms.falseInput.removeEventListener("focus",v.falseInputFocusListener)}function L(){this.elms.falseInput.disabled=!1,this.elms.falseInput.addEventListener("focus",v.falseInputFocusListener.bind(this))}function y(){let e,t=this.elms.src.nodeName.toLowerCase(),n=this.config.disabled=this.elms.src.disabled;e="select"===t?this.elms.src.selectedIndex>-1?this.elms.src[this.elms.src.selectedIndex].value:"":this.elms.src.value,""===e&&(this.elms.falseInput.value=""),n?(this.vars.isOpen&&l.call(this),g.call(this)):L.call(this)}function I(){let e=this.elms.src,t=this;new MutationObserver((function(n){n.forEach((function(n){"disabled"===n.attributeName&&(e.disabled?(g.call(t),r.call(t)):L.call(t))}))})).observe(e,{attributes:!0})}function C(e,l){let r=null;if(!e)throw new Error("You must supply either a HTMLInputElement, HTMLSelectElement or a CSS3 selector string.");if("string"==typeof e)r=document.querySelector(e);else if(e.nodeType){if(e.getAttribute("data-jsuggest"))return!1;r=e}if(!r)throw new Error("JSuggest element not found.");if(!/^(?:input|select)$/i.test(r.nodeName.toLowerCase()))throw new Error("The element is not a HTMLInputElement or HTMLSelectElement.");return r.setAttribute("data-randid",Math.random().toString(36).slice(2)),this.config=function(e,t){let s,i;for(s in n)(i=t.getAttribute("data-"+s))&&(n[s]=i),e&&e.hasOwnProperty(s)&&(n[s]=e[s]);return n}(l,r),this.vars=Object.assign({},t,{}),this.elms=function(e,t){let n=e.parentNode,i=s("div",{class:"jsuggest"}),l=s("div",{class:"false-input-container"}),r=s("input",{class:"false-input form-control",placeholder:t.placeholder,type:"search"}),a=s("div",{class:"dropdown-content"}),o=s("div",{class:"autocomplete"}),c=s("input",{placeholder:t.searchPlaceholder.replace("minLength",t.minLen),class:"real-input form-control",tabindex:-1,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",type:"search",role:"textbox"});return r.required=e.required,e.required=!1,o.style.display="none",l.appendChild(r),t.width&&s(r,{style:{width:t.width}}),e.style.display="none",a.style.display="none",i.appendChild(e),i.appendChild(l),a.appendChild(c),a.appendChild(o),i.appendChild(a),n.appendChild(i),e.setAttribute("data-jsuggest","true"),window.addEventListener("load",(function(){let e=r.getBoundingClientRect();a.style.width=e.width+"px"})),window.addEventListener("resize",(function(){let e=r.getBoundingClientRect();a.style.width=e.width+"px"})),{src:e,copy:"select"===e.nodeName.toLowerCase()?e.innerHTML:e.value,container:o,dropdown:i,dropdowncontent:a,falseClear:null,falseInput:r,parentNode:n,realInput:c}}(r,this.config),i(this.elms.falseInput,r),y.call(this),I.call(this),!0}function w(){let t=this.elms,n={};for(let e in v)n[e]=v[e].bind(this);t.container.addEventListener("focus",n.containerFocusListener),t.hasOwnProperty("falseClear")&&t.falseClear&&t.falseClear.addEventListener("click",n.falseClearClickListener),t.falseInput.addEventListener("search",n.falseClearClickListener),t.falseInput.addEventListener("focus",n.falseInputFocusListener),t.falseInput.addEventListener("change",n.falseInputChangeListener),t.realInput.addEventListener("keydown",n.realInputKeydownListener),t.realInput.addEventListener(e.keyUpEventName,n.realInputKeyupListener),t.realInput.addEventListener("blur",n.realInputBlurListener),t.realInput.addEventListener("focus",n.realInputFocusListener),t.container.addEventListener("focus",n.containerFocusListener),t.container.addEventListener("containerMousedown",n.containerMousedownListener)}function b(){this.elms.realInput.removeEventListener("focus",v.realInputFocusListener),this.elms.realInput.removeEventListener("keydown",v.realInputKeydownListener),this.elms.realInput.removeEventListener(this.vars.keyUpEventName,v.realInputKeyupListener),this.elms.realInput.removeEventListener("blur",v.realInputBlurListener),this.elms.container.removeEventListener("focus",v.containerFocusListener),this.elms.container.removeEventListener("mousedown",v.containerMousedownListener),this.elms.hasOwnProperty("falseClear")&&this.elms.falseClear&&this.elms.falseClear.removeEventListener("click",v.falseClearClickListener),this.elms.falseInput.removeEventListener("search",v.falseClearClickListener),u.call(this),l.call(this)}function E(){v.falseInputFocusListener.call(this)}function x(e){let t=this.elms.src,n=t.nodeName.toLowerCase();"select"===n?(t.length=0,t.appendChild(createElement("option",{value:e.id,text:e.value,selected:"selected"}))):"input"===n&&createElement(t,{value:e.id,title:e.value+". "+e.id})}function S(e){if(!(e instanceof JsonApiSpec))throw new Error("Invalid argument. expected instance of JsonApiSpec, got "+typeof e);this.vars.selected!==e&&(this.vars.selected=e);let t=a.getTemplate(e),n=createElement(this.elms.falseInput,{value:e.toString(),title:e.toString()+". "+e.id,idx:e.id});t&&t.setInput(n),x.call(this,{id:e.id,value:e.toString()})}function T(e,t){if(!(this instanceof T))return new T(e,t);C.call(this,e,t)&&(w.call(this),a.addInstance(this.elms.src.dataset.randid,this))}return T.prototype.destroy=function(){return b.call(this),this},T.prototype.focus=function(){return E.bind(this),this},T.prototype.disable=function(){return g.call(this),this},T.prototype.enable=function(){return L.call(this),this},T.prototype.clearItems=function(){return l.call(this),this},T.prototype.clearValues=function(){return r.call(this),this},T.prototype.setValue=function(e){return S.call(this,e),this},T.prototype.update=function(){return c.call(this),this},T.prototype.getInstance=function(){return cache.get(el)},T.prototype.getSource=function(){return this.elms.source},T.cache=a,T.copy=function(e){let t=a.get(e);if(!t)return;let n,s,i,l=t.getSource();"select"===l.nodeName.toLowerCase()?l.selectedIndex>-1?(n=l[l.selectedIndex].innerHTML,s=l[l.selectedIndex].value):n="":(n=l.value,s=l.value),""!==n&&(i={id:s,attributes:{name:n},type:l.dataset.specType},sessionStorage.setItem(e.name+".spec",JSON.stringify(i)))},T.paste=function(e){let t,n=sessionStorage.getItem(e.name+".spec"),s=a.get(e);n&&s&&(t=new JsonApiSpec(JSON.parse(n)),t.toString=()=>t.attributes.name,s.setValue(new JsonApiSpec(JSON.parse(n))))},T}();
